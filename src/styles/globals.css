@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* 复古终端配色方案 */
  :root {
    /* 浅色模式 - 米白纸张 + 复古森林绿 */
    --background: 45 20% 98%;
    --foreground: 120 10% 10%;
    --primary: 120 40% 25%;
    --primary-foreground: 0 0% 98%;
    --secondary: 45 30% 95%;
    --muted: 45 20% 94%;
    --muted-foreground: 120 10% 40%;
    --accent: 35 50% 85%;
    --border: 120 10% 88%;
    --card-background: 0 0% 100%;
    --card-foreground: 120 10% 10%;
    --radius: 0.5rem;
    /* 终端绿 */
    --terminal-green: 120 60% 35%;
    /* 奶油金 */
    --cream-gold: 35 60% 75%;
  }

  [data-theme="dark"] {
    /* 深色模式 - 深黑终端 + 荧光绿 */
    --background: 0 0% 10%;
    --foreground: 45 20% 92%;
    --primary: 120 70% 55%;
    --primary-foreground: 0 0% 10%;
    --secondary: 120 10% 15%;
    --muted: 120 10% 15%;
    --muted-foreground: 120 20% 60%;
    --accent: 45 60% 40%;
    --border: 120 20% 20%;
    --card-background: 0 0% 14%;
    --card-foreground: 45 20% 92%;
    /* 终端荧光绿 */
    --terminal-green: 120 85% 60%;
    /* 奶油黄 */
    --cream-gold: 60 80% 65%;
  }

  * {
    @apply border-border;
  }

  html {
    @apply antialiased;
  }

  body {
    @apply bg-background text-foreground;
    font-feature-settings: 'rlig' 1, 'calt' 1;
  }

  /* 平滑滚动 */
  html {
    scroll-behavior: smooth;
  }

  /* 选中文本样式 - 复古绿 */
  ::selection {
    background-color: hsl(var(--terminal-green) / 0.2);
  }

  /* 移动端防止横向溢出 - 全局规则 */
  @media (max-width: 768px) {
    html, body {
      overflow-x: hidden;
      max-width: 100vw;
    }

    /* 确保所有元素不超出视口 */
    * {
      max-width: 100%;
    }

    /* 装饰性光晕不造成溢出 */
    .decorative-blob {
      max-width: none;
      max-height: none;
    }

    /* main 容器不溢出 */
    main {
      overflow-x: hidden;
      width: 100%;
    }
  }
}

@layer utilities {
  /* 复古终端文字渐变 */
  .text-gradient {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-terminal-green to-cream-gold;
  }

  /* 终端装饰性背景网格 */
  .bg-grid {
    background-image: linear-gradient(to right, hsl(var(--border)) 1px, transparent 1px),
      linear-gradient(to bottom, hsl(var(--border)) 1px, transparent 1px);
    background-size: 40px 40px;
  }

  .bg-grid-radial {
    background-image: radial-gradient(circle at 1px 1px, hsl(var(--terminal-green) / 0.15) 1px, transparent 0);
    background-size: 24px 24px;
  }

  /* 扫描线效果 */
  .scanlines {
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      hsl(var(--background) / 0.03) 2px,
      hsl(var(--background) / 0.03) 4px
    );
    pointer-events: none;
  }

  /* 自定义滚动条 - 复古风格 */
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    @apply bg-secondary;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    @apply rounded;
    background-color: hsl(var(--terminal-green) / 0.4);
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: hsl(var(--terminal-green) / 0.6);
  }

  /* 阅读进度条容器 */
  .reading-progress-container {
    @apply fixed top-0 left-0 right-0 h-1 bg-secondary z-50;
  }

  .reading-progress-bar {
    @apply h-full bg-gradient-to-r from-terminal-green to-cream-gold transition-all duration-150 ease-out;
  }

  /* TOC 活动链接样式 - 终端树状风格 */
  .toc-link {
    @apply block py-1.5 text-sm text-muted-foreground hover:text-terminal-green transition-colors;
    border-left: 2px solid transparent;
    padding-left: 1rem;
  }

  .toc-link.active {
    @apply text-terminal-green font-medium;
    border-left-color: hsl(var(--terminal-green));
  }

  /* 玻璃态效果 */
  .glass {
    background: hsl(var(--background) / 0.85);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
  }

  /* 终端发光效果 */
  .terminal-glow {
    box-shadow: 0 0 30px hsl(var(--terminal-green) / 0.2);
  }

  /* 卡片悬停效果 */
  .card-hover {
    @apply transition-all duration-300;
  }

  .card-hover:hover {
    @apply -translate-y-1;
    box-shadow: 0 10px 40px -10px hsl(var(--terminal-green) / 0.15);
    border-color: hsl(var(--terminal-green) / 0.3);
  }

  /* 终端窗口样式 */
  .terminal-window {
    @apply relative bg-card-background rounded-lg border border-border overflow-hidden;
  }

  .terminal-header {
    @apply flex items-center gap-2 px-4 py-3 bg-secondary/50 border-b border-border;
  }

  .terminal-dot {
    @apply w-3 h-3 rounded-full;
  }

  .terminal-body {
    @apply p-6;
  }

  /* 打字机光标动画 */
  @keyframes blink-cursor {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  .cursor-blink {
    animation: blink-cursor 1s step-end infinite;
  }

  /* 打字机动画 */
  @keyframes typing {
    from { width: 0; }
    to { width: 100%; }
  }

  .typing-effect {
    overflow: hidden;
    white-space: nowrap;
    border-right: 2px solid hsl(var(--terminal-green));
    animation: typing 2s steps(40, end), blink-cursor 0.75s step-end infinite;
  }
}

/* 代码块样式 - 终端风格 */
.shiki {
  @apply rounded-lg overflow-hidden;
  padding: 1.25rem !important;
  font-size: 0.875rem;
  line-height: 1.7;
  background: hsl(0 0% 10%) !important;
}

/* 移动端 shiki 代码块适配 */
@media (max-width: 768px) {
  .shiki {
    padding: 0.75rem !important;
    font-size: 0.75rem !important;
    line-height: 1.5;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  .shiki code {
    white-space: pre !important;
    display: block !important;
  }
}

/* 代码块窗口控制点 */
.shiki::before {
  content: '';
  @apply flex gap-1.5 px-3 py-2;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  background: hsl(0 0% 12%);
  border-bottom: 1px solid hsl(0 0% 20%);
}

.prose pre {
  @apply relative mt-6;
}

.prose pre::before {
  content: '● ● ●';
  @apply text-xs text-gray-500 flex gap-1.5 px-3 py-2 absolute top-0 left-0 right-0;
  background: hsl(0 0% 12%);
  border-bottom: 1px solid hsl(0 0% 20%);
  border-radius: 0.5rem 0.5rem 0 0;
}

/* 防止内容溢出 */
.prose {
  @apply max-w-full;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.prose * {
  max-width: 100%;
}

/* 代码块滚动 */
.prose pre {
  @apply overflow-x-auto;
  max-width: 100vw;
}

/* 表格样式 */
.prose table {
  @apply w-full border-collapse;
  margin: 1.5rem 0;
  display: table;
  table-layout: auto;
}

.prose th {
  @apply bg-secondary font-semibold text-left;
  padding: 0.75rem 1rem;
  border: 1px solid hsl(var(--border));
}

.prose td {
  @apply border-border;
  padding: 0.75rem 1rem;
  border: 1px solid hsl(var(--border));
  word-break: normal;
}

.prose tr:nth-child(even) {
  @apply bg-muted/30;
}

.prose tr:hover {
  background-color: hsl(var(--terminal-green) / 0.05);
}

/* 文章封面渐变遮罩 */
.cover-gradient {
  background: linear-gradient(
    to bottom,
    transparent 0%,
    hsl(var(--background)) 100%
  );
}

/* 动画 */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

@keyframes terminal-flicker {
  0%, 100% { opacity: 1; }
  92% { opacity: 1; }
  93% { opacity: 0.8; }
  94% { opacity: 1; }
}

.animate-fade-in {
  animation: fade-in 0.5s ease-out;
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-terminal-flicker {
  animation: terminal-flicker 4s infinite;
}

/* 装饰性光晕 - 复古绿 */
.decorative-blob {
  position: absolute;
  border-radius: 50%;
  filter: blur(80px);
  opacity: 0.3;
  pointer-events: none;
}

/* 终端命令提示符样式 */
.terminal-prompt {
  @apply text-terminal-green font-mono;
}

.terminal-prompt::before {
  content: '$ ';
  color: hsl(var(--terminal-green));
}

/* 标签样式 - 数组风格 */
.tag-array {
  @apply inline-flex items-center gap-1 px-2.5 py-1 rounded-md bg-secondary border border-border text-sm;
  font-family: 'Monaco', 'Menlo', monospace;
}

.tag-array::before,
.tag-array::after {
  content: '[';
  @apply text-muted-foreground;
}

.tag-array::after {
  content: ']';
}

/* 按钮终端风格 */
.btn-terminal {
  @apply relative inline-flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium text-sm transition-all duration-200;
  background: linear-gradient(135deg, hsl(var(--terminal-green)), hsl(120 50% 30%));
  color: hsl(var(--primary-foreground));
  border: 1px solid hsl(var(--terminal-green));
  box-shadow: 0 4px 0 hsl(120 40% 15%);
}

.btn-terminal:hover {
  box-shadow: 0 2px 0 hsl(120 40% 15%);
  transform: translateY(2px);
}

.btn-terminal:active {
  box-shadow: none;
  transform: translateY(4px);
}

.btn-terminal-outline {
  @apply inline-flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium text-sm transition-all duration-200;
  @apply bg-transparent border border-border text-foreground;
}

.btn-terminal-outline:hover {
  border-color: hsl(var(--terminal-green) / 0.5);
  color: hsl(var(--terminal-green));
}

/* 移动端代码块和内容修复 - 防止横向溢出 */
@media (max-width: 768px) {
  /* terminal-window 和 terminal-body 移动端适配 - 不允许页面横向滚动 */
  .terminal-window {
    max-width: 100%;
    overflow: hidden;
  }

  .terminal-body {
    padding: 0.75rem 1rem !important;
    overflow: hidden;
  }

  /* terminal-body 内的 flex 容器 */
  .terminal-body > .flex {
    gap: 0.75rem;
  }

  /* 通用 pre 标签适配 - 内部可滚动，不影响页面 */
  pre {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    max-width: 100%;
    width: 100%;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding: 0.5rem !important;
    font-size: 0.65rem !important;
    line-height: 1.3;
    white-space: pre;
    word-wrap: normal;
    word-break: normal;
    display: block;
    box-sizing: border-box;
  }

  /* prose 容器限制 */
  .prose {
    max-width: 100% !important;
    overflow-x: hidden !important;
  }

  /* prose 子元素（除了 pre）限制宽度 */
  .prose > *:not(pre) {
    max-width: 100% !important;
  }

  /* prose 代码块 */
  .prose pre {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    max-width: 100%;
    margin-left: 0 !important;
    margin-right: 0 !important;
    border-radius: 0.5rem;
    font-size: 0.75rem;
    line-height: 1.5;
    white-space: pre;
  }

  .prose pre code {
    white-space: pre;
    display: block;
    overflow-x: visible;
  }

  /* 内联代码自动换行 */
  .prose > code,
  .prose p > code,
  .prose li > code {
    word-break: break-all;
    overflow-wrap: break-word;
    white-space: pre-wrap;
  }

  /* 表格适配 */
  .prose table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }

  /* 图片自适应 */
  .prose img {
    max-width: 100%;
    height: auto;
  }

  /* 统计数据容器移动端适配 */
  .inline-block {
    max-width: 100%;
    overflow-x: auto;
  }
}

/* 编辑器内容区域移动端适配 */
@media (max-width: 768px) {
  .ProseMirror {
    padding: 1rem !important;
    max-width: 100%;
    overflow-x: hidden;
  }

  .ProseMirror > * {
    max-width: 100%;
  }

  .ProseMirror p,
  .ProseMirror h1,
  .ProseMirror h2,
  .ProseMirror h3,
  .ProseMirror h4,
  .ProseMirror h5,
  .ProseMirror h6 {
    max-width: 100%;
    overflow-wrap: break-word;
    word-break: break-word;
  }

  .ProseMirror pre {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    white-space: pre;
    font-size: 0.75rem;
    max-width: 100%;
    word-break: normal;
  }

  /* 编辑器内表格 */
  .ProseMirror table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* 编辑器内代码 */
  .ProseMirror code {
    word-break: break-all;
    overflow-wrap: break-word;
  }
}
